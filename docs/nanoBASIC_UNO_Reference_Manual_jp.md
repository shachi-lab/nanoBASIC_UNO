# 📘**nanoBASIC UNO リファレンスマニュアル**

日本語版
Version 0.18 対応

## 概要
Arduino UNO 上で動作（ATmega328P）上で動作するBASICインタプリターです。  
入力された命令文を中間言語（バイトコード）に翻訳し、  
インタプリター方式で処理を実行します。

* 行番号はラベルとして扱う（順序とは無関係）
* コードは中間コード化して1行ごとに63バイト以内
* 再帰を使わない手書きの式パーサ
* プログラム領域はRAM上に置き、PROGで直接書き込む
* プログラムをEEPROMに保存可能
* REPL / Run の 動作モード

---

## 動作モード
動作モードには、「REPLモード」と「Runモード」があります。  
* **REPLモード（対話実行）**  
  シリアルポートからの入力文字列を命令文として、  
  １行毎にインタラクティブにコマンドを実行します。
* **Runモード（プログラム実行）**  
  プログラム領域に保存されたプログラムを順次実行します。  

nanoBASIC UNO の起動直後は、REPLモードになります。  

---

## REPLモード

コマンド等はシリアルポートから入力します。  
ステートメントは大文字、小文字を区別しません。  
ただし、コメントおよび文字列中の内容は入力されたとおりとなります。

入力中の簡単な編集操作が可能です。  
編集には、←、→、DEL、BS、HOME、END キーが利用できます。  
入力履歴を上矢印キーで呼び出すことができます。

このモードでは、入力した1行の命令は  
- **即座に実行されますが、プログラム領域には保存されません。**  
- **変数の内容は保持されます。**  

簡単な計算、動作確認、試行錯誤  
などに向いたモードになっています。

---

## Run モード

複数行のプログラムを保存して実行したい場合は、  
PROG コマンドを使用してください。  

---

## 数値
nanoBASIC の数値は、デフォルトでは 16bit 整数（-32768〜32767）です。  
ビルド時の設定で、32bit 整数とすることが可能です。  

floatなどの浮動小数点はありません。  
演算によるオーバーフローは考慮しません。  
デフォルトの数値は10進数です。  
数値の前に「0x」をつけると16進数となります。  
```
A=10
B=0xBEEF
```

---

## 文字列

ダブルクォーテーション（"）で囲まれた部分を文字列として扱います。

文字列は、PRINT コマンド（または ?）でのみ使用可能です。  
変数への代入や、式の中での使用はできません。  
文字列には、C 言語互換のエスケープシーケンスが利用できます。  

### 使用可能なエスケープシーケンス

#### 制御文字・記号（C 言語互換）

| 記述 | 意味 |
|---|---|
| \a | ベル |
| \b | バックスペース |
| \f | フォームフィード |
| \n | 改行 |
| \r | 復帰 |
| \t | タブ |
| \v | 垂直タブ |
| \\ | バックスラッシュ |
| \' | シングルクォート |
| \" | ダブルクォーテーション |
| \? | クエスチョンマーク |

#### 数値指定エスケープ
- \ooo  
  8進数で文字コードを指定します（0〜377）
- \xhh  
  16 進数で文字コードを指定します（00〜FF）

注意事項
- 数値指定エスケープは 1 文字として展開されます
- 文字コードは 8bit（0〜255）で解釈されます
- UTF-8 文字と混在させることも可能ですが、  
  可読性の観点から使用には注意してください

---

## 変数
* 変数：  
  A ～ Zまでの26個  
  （符号付16ビット整数）
* 配列変数：  
  @[index] で表される１次元配列が１つ  
  符号付16ビット整数、indexの範囲は0～63  

bit数 と 配列の大きさは、ビルド時の設定により変更可能です。

- すべてグローバル変数です。  
- ローカル変数はありません。  
- 文字列変数はありません。

---

## 演算子
式には、以下の演算子が使用可能です。

### 二項演算子  
|演算子 |意味 |
|:---:|-----|
|\+ | 加算|
|\- | 減算|
|\* | 乗算|
|\/ | 除算|
|\%  | 剰余|

### 単項演算子
|演算子 |意味 |
|:---:|-----|
|- | 符号反転 |
|~ | ビット反転|
|! | 否定(NOT)|

### 論理演算子
|演算子 |意味 |
|:---:|-----|
|&& | 論理積 (AND)|
|\|\| | 論理輪 (OR)|

### ビット演算子
|演算子 |意味 |
|:---:|-----|
|& | ビット単位の論理積 (AND)|
|\| | ビット単位の論理輪 (OR)|
|^ | ビット単位の排他的論理輪(XOR)|

### シフト演算子
|演算子 |意味 |
|:---:|-----|
|<< | 左シフト|
|>> | 右シフト|

### 比較演算子
|演算子 |意味 |
|:---:|-----|
|=, == | 一致|
|<>, !=| 不一致|
|<  | 未満|
|<= | 以下|
|>  | 超過|
|>= | 以上|

### 括弧
|演算子 |意味 |
|:---:|-----|
|(式) | 括弧の内側を優先して演算|

---

## 式
数値および演算子を使用したものを「式」とします。  
式は、数値、変数、演算子を使って記述します。  
コマンドの引数や代入文に、式の記述が可能です。  
基本的な優先度に従って演算されます。

---

## 代入文
「変数 = 式」
変数名に続けて「＝」の後に式を記述すると、  
式の演算結果が変数に代入されます。  
LETコマンドはありませ。
```
A=10
```
---

## 複合代入演算子
変数への代入には、以下の複合代入演算子が使用できます。  
+=、 =、 *=、 /=、 %=、 |=、 &=、 ^= 、 <<=、 >>=  
変数の数値と演算子で演算した結果を変数に代入します。
```
A+=10+B
A<<=1
```

---

## インクリメント、デクリメント
変数に続けて、"++" または、"--" を記述すると、  
変数の内容を インクリメント(+1) または、デクリメント(-1) します。  
※ 式の中には記述できません。 単独でのみ使用可能です。 
```
A++
@[10]--
```

---

## 命令文
命令文は、1つ以上のコマンドまたは代入文です。  
コマンドや代入文を「：」でつなげてマルチステートメントにすることができます。  
ただし、１行は79文字または、バイトコードに変換したときに79バイト以下にしてください。  
文字数の制限は、ビルド時の設定で変更が可能です。

---

## ラベル番号
プログラムの GOTOやGOSUBなどの分岐先を示すもので、  
プログラム各行の行頭につける番号です。  
ラベル番号は行頭のみ、0～32767 までの値を設定できます。  
プログラム中に同一のラベル番号が存在してもエラーにはならなりませんが、  
プログラムの先頭に近いほうが有効となります。  
また、ラベル番号は必須ではありませんので、ラベル番号が必要な行のみにつけてください。  
ラベル番号の値とプログラムの実行順に関連はありません。

---

## 行番号
行番号は、プログラムの最初から何行目かを表す数値です。  
行番号(line number)とラベル番号は別物です。  
したがって、GOTO、GOSUB 等での飛び先には使用できません。

---

## 動作の中断
端末からシリアルポートに「Ctrl-C(0x03)」を送信することによって、  
プログラムの動作を中断することができます。  
中断したプログラム動作はRESUMEコマンドで中断箇所から再開することができます。  
ただし、エラー等で処理が中断した場合はRESUMEコマンドでの再開はできません。

---

## 入れ子
GOSUB～RETURN、FOR～NEXT、DO～LOOP、WHILE～LOOPの  
入れ子のスタックはすべて共通です。
スタックの深さは８段階です。  
入れ子が８段階を超ええると、スタックオーバーフローエラーとなります。

---

## コメント
「'」（シングルクォート）以降の内容が行末までコメントとなります。   
コメントは実行には影響がありません。   
シングルクォートの数によって、以下のような扱いとなります。  

- '（シングルクォート 1 個）  
  → コメントとして PROG エリアに保存されます  
  → LIST に表示されます
- ''（シングルクォート 2 個）  
  → コメントは PROG エリアには格納されません  
  → LIST に表示されません
```
' この行はコメントとして保存される（容量を消費）
'' この行は保存されない（容量を消費しない）
```
この仕様は、プログラムの可読性とプログラム領域の容量の節約の  
両方に対応するためのものです。

---

## コマンド
命令文には以下のコマンドが使用できます。

### PRINT
書式：PRINT 文字列式  

PRINTの代わりに "?" での代用が可能です。  
数値，文字列を出力します。  
文字列式には１つまたは複数の式または文字列を指定できます。  
複数の式、文字列はコンマやセミコロンで区切って指定します。  
コンマで区切るとタブ出力になり、セミコロンで区切ると続けて出力します。  
文字列と式との間はセミコロンの省略が可能です。  
文字列式の最後をセミコロンで終了すると改行を出力しません。  
PRINT文中でのみ、文字列、CHR関数、文字列化指定が利用できます。  

文字列には、C言語互換のエスケープシーケンスが使用可能です。  
詳細は、[使用可能なエスケープシーケンス] を参照してください。

#### 数値の表示と書式指定
`PRINT` では、次のように数値の表示形式を指定できます。

##### 10進数表示
* `DEC(式)`  
  → 桁数を0に指定した場合、および書式指定をしないときと同じです
* `DEC(式, 桁数)`  
  → 桁数を指定して表示

##### 16進数表示

* `HEX(式)`  
  → 16進数で表示（桁数を0に指定した場合と同じ）
* `HEX(式, 桁数)`  
  → 桁数を指定して 16進数表示

##### 桁数指定について
* **桁数が正の値**  
  → 左側を **スペースで埋める**（リーディングスペース）
* **桁数が負の値**  
  → 左側を **ゼロで埋める**（リーディングゼロ）

```
? DEC(1234) "," DEC(1234,-5) "," DEC(5678,5)
1234,01234, 5678
? HEX(1234) "," HEX(1234,-5) "," HEX(5678,5)
4D2,004D2, 162E
```

##### 符号付き数値（10進数）
* 数値が負の場合、符号（`-`）を含めて  
  指定した桁数以内に収まるときは、指定桁数で表示されます  
* 収まらない場合は、符号分だけ桁数が増えます
```
A=-1234
? DEC(A,3) "," DEC(A,6) "," DEC(A,-6)
-234, -1234,-01234
```

##### 16進数表示時の注意
* 16進数表示では、**数値が負の場合でも符号は表示されません**  
  （内部表現の補数のまま表示されます）
```
? HEX(-1)
FFFF
```

##### 小数点以下の桁数指定
* 桁数に **100 の位が含まれる場合**、  
  その桁の位置に **小数点を挿入して表示** します
* 小数点を含めて、指定した桁数以内に収まるときは、  
  指定桁数で表示されます  
  収まらない場合は、小数点分だけ桁数が増えます  
```
A=1234
? DEC(A,200) "," DEC(A,205) "," DEC(-A,-306) "," DEC(A,500)
12.34, 12.34,-01.234,0.01234
```

---

### INPUT  
書式：INPUT 変数名  

シリアルポートからの入力を待ち、入力された数値を変数に格納します。  
入力する数値の先頭が 0x の場合は、16進数として扱います。  

### GOTO
書式：GOTO 式  

式で指定されたラベル番号にジャンプします。  
※ 式は数値リテラルから始まる必要があります。 

### GOSUB  
書式：GOSUB 式  

式で指定されたラベル番号のサブルーチンにジャンプします。  
サブルーチン内のRETURNコマンドにより、本コマンドの次の命令文に戻ります。  
※ 式は数値リテラルから始まる必要があります。

### RETURN
書式：RETURN  

サブルーチンから戻ります。

### IF / THEN / ELSEIF / ELSE / ENDIF
書式：IF 式 THEN 命令文 ELSEIF 式 THEN 命令文 ELSE 命令文 ENDIF  

条件によって実行する命令文に制御を移します。  
式の演算結果が 0 の場合は偽、0 以外の場合は真 として判定されます。

- ELSEIF、ELSE は省略できます
- ELSEIF–THEN の組み合わせは複数記述できます
- THEN または ELSE の直後に 数値から始まる式を記述した場合、  
  GOTO と同様の動作になります

補足：  
- IF が実行されていない状態で ELSE または ELSEIF を実行した場合、  
  対応する ENDIF まで処理をスキップします。
- IF が実行されていない状態で THEN または ENDIF を実行した場合、  
  何も行わず次の命令に進みます。

### FOR / TO / STEP / NEXT
書式：FOR 変数名=式１ TO 式２ STEP 式３ ～ NEXT

変数名に式１を代入した後、変数が式２になるまでFORとNEXTとの間をループします。  
プログラムがNEXTに来る毎に、変数に式３の値が加算されます。  
STEP 式３は省略可能で、省略された場合は１が指定されたことになります。  

### DO / LOOP
書式： DO ～ LOOP  

DO～LOOP を繰り返します  

### DO / LOOP WHILE
書式：DO ～ LOOP WHILE 式

式の結果が「真」のとき、DO～LOOP WHILEを繰り返します。  
DO～LOOP間を実行した後に式の判定をして、真のときに繰り返します。

### WHILE / LOOP
書式：WHILE 式 ～ LOOP

式の結果が「真」のとき、WHILE～LOOPを繰り返します。  
式の判定をした後、真のときにWHILE～LOOP間を繰り返します。

### EXIT
書式：EXIT

現在実行中の FOR～NEXT、DO/WHILE～LOOPの繰り返し処理から抜け出ます。  
NEXTまたはLOOP(LOOP WHILE)の直後の命令文に処理を移します。

### CONTINUE
書式：CONTINUE

現在実行中の FOR～NEXT、DO / WHILE～LOOP の  
残りの処理をスキップし、そのループの次の繰り返し処理に進みます。

ループの種類によって、動作が異なります。  
- DO / WHILE / LOOP 系のループ  
  → 現在のループの 先頭（条件判定位置） に戻ります。
- FOR / NEXT ループ
  → 現在のループに対応する NEXT 文 にジャンプし、  
  ループ変数を更新したあと、次の繰り返しに進みます。

### END
書式：END

プログラムの実行を終了して、REPLモードに戻ります。  
REPL モードで実行すると、入れ子のスタックおよびプログラムの中断状態を初期化します。  

### STOP
書式：STOP

プログラムの実行を中断します。  
RESUMEでの再開が可能です。

### RESUME
書式：RESUME

STOP または、シリアルポートからの Ctrl-C 受信で中断した処理を再開します。  
エラーによる中断は再開できません。

### DELAY
書式：DELAY 式

式で指定した時間だけ待ちます。
単位は1msecです。

### PAUSE
書式：PAUSE

シリアルポートから１文字が入力されるまで待ちます。

### DATA
書式：DATA　式１、式２・・・

READコマンドで読み込む数値を記載します。  
数値だけでなく、式も記述可能です。  
複数の式をカンマで区切って記述します。  
DATAコマンドは、IFやループの影響を受けません。

### READ
書式：READ 変数

DATAコマンドで記載された式の数値を、変数に読み込みます。  
READコマンドを実行するたびに、DATAコマンドでの記載順に読み込まれます。   
読み込むDATAが無くなってからREADするとエラーとなります。  

### RESTORE
書式：RESTORE

READコマンドで読み込むDATAコマンドの順番を、プログラムの先頭に戻します。

### RESET
書式：RESET

システムリセットを実行します。

### NEW
書式：NEW

プログラム領域に書きこまれたプログラムを削除します。

### PROG
書式：PROG

プログラム領域にプログラムを書き込みます。  
「＞」の表示に続けて、書き込むプログラムを１行ごとに入力します。  
行頭が「＃」の行を入力すると、書き込みモードを終了します。  
なお、インデントや不要なスペース等は無視され、 
コメントと文字列以外はすべて大文字になります。  
また、バイトコードへの変換時に文法エラー等があった場合は、  
その行はプログラム領域書き込まれずにエラーを出力しますが、  
書き込みモードは終了せずに次行の入力となります。

空行や「''」（シングルクォート 2 個）のコメントのみの行は  
読み飛ばされます。

なお、プログラム中に意図的に「空行」を残したい場合は、
「:」（コマンドの区切り）だけを記述した行を使用してください。

##### 注意事項
* 入力１行毎にバイトコードへの変換が行われるので、連続して行を入力する場合は、  
  変換に必要な時間を考慮して、行間に100ms程度のウエイトを入れてください。  
* プログラム領域はRAM上にあるため、リセットや電源OFFによって消去されます。  
* SAVE / LOAD コマンドで、EEPROMへの保存と読み込みが可能です。

入力例：
```
PROG
> '' このコメントは読み飛ばされます
> DO
>  OUTP 13, 1
>  DELAY 200
>  OUTP 13, 0
>  DELAY 200
> LOOP
>#
OK
RUN
```

### RUN
書式：RUN

Runモード になり、プログラム領域にあるプログラムを先頭から実行します。  
実行に先立って、各変数は０にクリアされます。  
プログラムエリアのプログラムの実行が終了および中断すると  
REPLモードに戻ります。

### LIST
書式：LIST

プログラム領域に書き込まれたプログラムを出力します。  

表示スタイル（大文字／小文字）は、ビルド時に設定できます。

### SAVE
書式：SAVE [引数]

プログラムエリアの内容をEEPROMへ保存または消去します。  
EEPROMに保存したプログラムはリセット、電源断によっても消去されません。  
また、自動実行に設定することもできます。  
EEPROMに保存したプログラムは、LOADコマンドで読み出しが可能です。  

- **通常保存**（引数なし）  
  プログラムエリアの内容をEEPROMへ保存します。  
  プログラムエリアが空の場合はエラー（誤操作防止のため）となります。  
  AutoRun は無効になります。
- **AutoRun保存** （引数：`!`）  
  通常保存に加えて、AutoRun を有効にして保存します。  
  AutoRun が有効の場合は、電源投入時に LOAD 後に自動実行されます。  
- **消去**（引数：`0`）  
  EEPROMに保存されているプログラムを消去します。  
  プログラムエリアの内容には影響しなません、
  AutoRunmは無効になります。

### LOAD
書式：LOAD

EEPROMに保存されたているプログラムを、プログラムエリアに読み込みます。  
プログラムエリアにある既存プログラムと置き換わります。  
EEPROMにプログラムが無いときはエラーとなります。

### RANDOMIZE
書式：RONDOMIZE　式

式で与えられた値で、乱数の種を設定します。

### OUTP
書式：OUTP　式１，式２

GPIOポートに出力します。
式１にはピン番号を指定します。  
下表以外のピン番号はエラーになります。  
式２に０を指定するとLow、０以外を指定するとHighを出力します。  
|Pin|Function|
|----|----|
|0-7 |PORTD|
|8-13|PORTB|
### PWM
書式：PWM  式１，式２

ポートにPWMを出力します。
式１にはピン番号を指定します。  
下表以外のピン番号はエラーになります。  
式２にはデューティ比（0から255）を指定します。    
※ Arduino UNO の analogWrite() を利用しているため、  
デューティ比は 0〜255 の8bit精度です。  
|Pin|Function|
|----|----|
|3,5,6,9,10,11|PWM|

---

## 関数

演算式には、関数を使用することができます。

### RND
書式：RND(式)

引数を超えない値の乱数が戻ります。

### ABS
書式：ABS(式)

引数の絶対値が戻ります

### INP
書式：INP(式)

GPIOから入力します。
引数にはピン番号を指定します。  
下表以外のピン番号はエラーになります。  
ポートの状態がLowのときは０，Highのときは１が戻ります。
|Pin|Function|
|----|----|
|0-7 |PORTD|
|8-13|PORTB|

### ADC
書式：ADC(式)

アナログポートから入力します。  
ADコンバーターからの0から1023までの整数値が戻ります。  
引数にはADC番号を指定します。  
下表以外のADC番号はエラーになります。  
|ADC|Function|
|----|----|
|0-5|ADC|

### INKEY
書式：INKEY(式)

シリアルポートから 1文字のキー入力 を取得します。  
引数には、タイムアウト時間をミリ秒（ms）単位で指定します。

- 引数に 0 以下を指定した場合、タイムアウトせず  
  キー入力があるまで待機します。
- 指定時間内に入力がない場合は -1 を返します。
- 入力があった場合は、その ASCIIコードを返します。

※ Ctrl-C は常に実行中断として処理され、INKEY では取得できません。

## PRINT限定関数

nanoBASIC には、PRINTコマンドでのみ有効な関数があります。  

### CHR
書式：CHR(式)

PRINTコマンドで、式のASCIIコード文字を出力します。  
式の下位8bitが有効です。

### DEC
書式：DEC(式)、DEC(式,桁数)

式の数値を10進数で出力します。  
この関数を使用することで、10進数を任意の桁数で出力することができます。  
詳細は、PRINTコマンドの [数値の表示と書式指定] を参照してください。

### HEX
書式：HEX(式)、HEX(式,桁数)

式の数値を16進数で出力します。  
この関数を使用することで、16進数を任意の桁数で出力することができます。  
詳細は、PRINTコマンドの [数値の表示と書式指定] を参照してください。

---

## 予約変数・定数
nanoBASIC UNO にはシステムの予約変数があります。

### TICK
システムのクロックカウント値（約1msec毎にインクリメント）です。

---

## AutoRun 機能
NanoBASIC UNO には、電源投入時に EEPROM に保存されたプログラムを  
自動実行できる AutoRun 機能があります。  

AutoRun は SAVE コマンドの引数で指定する方式で、  
特別な設定コマンドは不要です。  
スタンドアロン動作や組み込み用途に便利な機能です。  

AutoRun が有効な場合、電源投入またはリセット後に約3秒待機し、  
その後 自動的に LOAD → RUN が実行されます。  

この 3 秒間に Ctrl-C を入力すると、AutoRun を中断して REPL モードに戻ります。  

---

## エラーメッセージ
エラーが発生したときは、以下のエラーメッセージを表示して処理を中止します。  
プログラムモードのときは、エラーが発生した行の行番号も表示します。  

* **Syntax error :**  
  文法エラーです。  
  認識できない命令文や記述ミスがあります。

* **Division by 0 error :**  
  ０で除算しました。

* **Array index over error :**  
  配列の添え字のが負数または範囲を超えています。

* **Parameter error :**  
  パラメーターが必要なコマンドにパラメーターが指定されていません。  
  または、パラメーターの範囲が不正です。

* **Stack overflow error :**  
  スタックがオーバーしました。  
  GOSUB,FOR,DO,WHILE の入れ子が８段を超えたました。

* **Can't resume error :**  
  プログラムを RESUMEコマンドで再開できません。  
  処理がエラーで中止されたときは再開ができません。

* **Label not found error :**  
  GOTO,GOSUBの指定先のラベル番号が見つかりませんでした。

* **Unless from run-mode error :**  
  Runモードでは実行できないコマンドです。  
  PROG,SAVE,LOAD,NEW,LIST,RUN,RESUMEコマンドは、Runモードで実行できません。

* **PG area overflow error :**  
  PROGコマンドのプログラム書き込みで、プログラムエリアの容量がオーバーしました。

* **PG empty error :**  
  SAVEコマンド または LOADコマンドで、プログラムがありませんでした。

* **Loop nothing error :**  
  DO/WHILEコマンドで、対応するLOOPがありません。

* **Endif not found error :**  
  IFに対応するENDIFがありません。

* **Unexpected Next error :**  
  NEXTに対応するFORコマンドがありません。

* **Unexpected Return error :**  
  RETURNに対応するGOSUBがありません。

* **Unexpected Loop error :**  
  LOOPに対応するDO/WHILEがありません。

* **Unexpected Exit error :**  
  EXITに対応するFORまたはDO/WHILEがありません。

* **Unexpected Continue error :**  
  CONTINUEに対応するFORまたはDO/WHILEがありません。

* **Unexpected Read error :**  
  READに対応するDATAがありません。

---

## 🆕 バージョン更新内容（追記用セクション）

### 🔄 主な変更点

Version 0.18 では、以下の機能拡張および内部改善が行われました。

* **32bit 整数対応（ビルド時に切り替え可能）**  
  従来の 16bit 整数に加え、ビルド設定により 32bit 整数を使用可能になりました。

* **REPL の変数保持・履歴機能を追加**  
  REPL モードにおいて、変数の保持およびコマンド履歴（上下キー操作）に対応しました。

* **奇数アドレスアクセスへの対応**  
  非アラインアクセスが許可されない MCU でも動作するよう、  
  内部実装を調整しています（他 MCU への移植性向上）。

* **文字列リテラルの C 言語風エスケープ対応**  
  文字列中で以下のようなエスケープシーケンスが使用できます。  
  `\n`, `\r`, `\t`, `\\`, `\"` など。

* **文字列およびコメントの UTF-8 対応**  
  PRINT 文中の文字列、およびコメント内で UTF-8 文字が使用可能になりました。

* **16進数表記を `$` から `0x` に変更**  
  数値リテラルの 16 進数表記は、C 言語と同様に `0x` プレフィックスを使用します。

---

## ⚠️ メモリ使用量に関する注意（重要）

nanoBASIC UNO は、ビルド時の設定によって RAM 使用量が大きく変化します。  
Arduino UNO（ATmega328P）は RAM が 2KB と非常に限られていて、  
以下の設定を同時に有効にした場合、**RAM 使用量がかなり逼迫します。**

* **32bit 整数有効**
* **REPL 履歴機能有効**

この構成でビルドすると、
UNO では **空き RAM が約 220 byte 程度** となり、  
この状態でも起動・実行は可能ですが、
- 実行中の一時バッファ  
- 式評価時のスタック使用  
- 再帰的な処理や深いネスト  

などにより、  
- 予期しない動作
- 実行停止
- ハングアップ

が起きる可能性があります。

### 🔧 推奨対策

空き容量を増やして安定動作させるため、  
以下のいずれか、または組み合わせを検討してください。  
`nano_basic_uno_conf.h` を編集し、ビルドしてください。  

* **プログラムエリアサイズを縮小する**  
  ```
  #define PROGRAM_AREA_SIZE 768 → 512
  ```
* **REPL 履歴機能を無効にする**
  ```
  #define REPL_HISTORY_ENABLE 1 → 0
  ```
* **16bit 整数構成でビルドする**
  ```
  #define NANOBASIC_INT32_EN  1 → 0
  ```
* **配列を小さくする**  
  ```
  #define ARRAY_INDEX_NUM   64 → 16
  ```

用途に応じて、
**ビルド時設定でメモリバランスを調整することを推奨します。**

---

## 📌 補足（設計方針として）

nanoBASIC UNO は、

* UNO で「ギリギリ動く」構成
* 他 MCU では余裕を持って動く構成

の両立を目指しています。

UNO では **機能を全部 ON にする前提ではない** ため、  
用途に合わせたビルド設定が前提となります。

---

## 📄 ライセンス

nanoBASIC UNO は、MIT License のもとで公開されています。

本ソフトウェアは、個人・商用を問わず自由に使用、改変、再配布が可能です。  
ただし、著作権表示およびライセンス文を  
ソースコードまたは配布物に含める必要があります。  

詳細なライセンス条文については、  
リポジトリ内の LICENSE.md を参照してください。

Copyright (c) 2025-2026 shachi-lab  
License: MIT
